#!/bin/bash

# usage: 1
#
# fork your Os Copy/Paste Clipboard Buffer into many Clones
#
# examples:
#   1  # captures 1'th copy of Os Copy/Paste Clipboard Buffer
#   1 |cat -  # shows 1'th copy
#   echo abc |1  # replaces 1'th copy
#   echo xyz |1 |tr '[a-z]' '[A-Z]'  # replaces 1'th and forwards it


# shellcheck disable=SC2002  # explicit Cat


set -e

if [ "$#" != 0 ]; then
    echo "usage: 1" >&2
    exit 1
fi

F="$HOME/.ssh/1.pbpaste"

if [ ! -d ~/.ssh ]; then
    (set -xe; mkdir -p ~/.ssh; chmod go-rw ~/.ssh)
fi

if [ ! -e $F ]; then
    (set -xe; touch $F)
fi

if [ -t 0 ] && [ -t 1 ]; then  # b.bash
    echo "+ pbpaste 1" >&2
    pbpaste >$F
elif [ -t 0 ]; then  # b.bash |...
    echo "+ pbcopy 1" >&2
    cat $F |pbcopy
    cat $F
elif [ -t 1 ]; then  # ... |b.bash
    echo "+ |pbcopy 1" >&2
    cat >$F
    cat $F |pbcopy
else  # ... |b.bash |...
    echo "+ |pbcopy 1 |" >&2
    cat >$F
    cat $F |pbcopy
    cat $F
fi


# ( cat bin/3 |sed 's,3,2,'g >bin/2 ) && ( cat bin/3 |sed 's,3,1,'g >bin/1 )
# chmod +x bin/[123]


# posted into:  https://github.com/pelavarre/byoverbs/blob/main/bin/1
# copied from:  git clone https://github.com/pelavarre/byoverbs.git
